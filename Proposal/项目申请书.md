<center><font size='7'>KubeMesh 高可用架构设计</font></center>

# 一. 项目背景

## 1.  项目任务的基本需求

> KubeEdge 基于 Kubernetes 构建，将云原生容器化应用程序编排能力延伸到了边缘。但是，在边缘计算场景下，网络拓扑较为复杂，不同区域中的边缘节点往往网络不互通，并且应用之间流量的互通是业务的首要需求，而 EdgeMesh 正是对此提供了一套解决方案。
> 
>                                                                                     ——官网项目描述

    Github Issue 当中所给的任务描述

> 1. 实现 EdgeMesh 的 aoturelay 和 autonat 机制
>    
>    核心要求是：将EdgeMesh-Server 的功能合并到EdgeMesh-Agent当中，主要目的是能够尽可能地实现节点的分布式网络治理和通信，让Agent之间能够不通过中枢直接通信
> 
> 2. 在EdgeMesh内实现多播dns的机制
>    
>    确保即使外网无法连接，非协调节点也能正常工作；实现类似于节点容灾自治的功能。

   

## 2.  项目相关技术细节

* 对于 KubeEdge 架构的理解和认识：
  
  * 在云端：CloudCoreService
    
    * CloudHub：一个web socket服务器，负责在云端观察变化，缓存并发送消息到EdgeHub。
    
    * EdgeController：一个扩展的 kubernetes 控制器，它管理边缘节点和 pod 元数据，以便可以将数据定位到特定的边缘节点。
    
    * DeviceController：一个扩展的 kubernetes 控制器，用于管理设备，以便设备元数据/状态数据可以在边缘和云之间同步。
  
  * 在边缘端：EdgeCoreService
    
    * EdgeHub：一个 Web 套接字客户端，负责与边缘计算的云服务交互（如 KubeEdge 架构中的边缘控制器）。 这包括将云端资源更新同步到边缘，以及向云端报告边缘端主机和设备状态的变化。
    
    * Edged：在边缘节点上运行并管理容器化应用程序的代理。
    
    * EventBus：一个 MQTT 客户端，用于与 MQTT 服务器（mosquitto）交互，为其他组件提供发布和订阅功能。
    
    * ServiceBus：与 HTTP 服务器 (REST) 交互的 HTTP 客户端，为云组件提供 HTTP 客户端功能，以访问在边缘运行的 HTTP 服务器。
    
    * DeviceTwin：负责存储设备状态并将设备状态同步到云端。 它还为应用程序提供查询接口。
    
    * MetaManager：edged 和 edgehub 之间的消息处理器。 它还负责在轻量级数据库 (SQLite) 中存储/检索元数据。
  
  在测试集群当中使用keadm部署，主要是对两个特应用进程做管理和启动，以下是架构图
  
  <img title="" src="file:///H:/Project6/KubeEdgeMeshLearning/Proposal/kubeedge_arch.png" alt="kubeedge_arch.png" width="445" data-align="center">

* 对于EdgeMesh 架构的理解和认识：
  
  * EdgeMesh Server
    
    **Tunnel-Server**
  
  * EdgeMesh Agent
    
    * Proxier：负责配置内核的iptables规则，拦截对EdgeMesh进程的请求
    
    * DNS Resolver ：内置DNS解析器，将节点内的DNS请求解析成服务集群IP
    
    * Traffic Forwarding：基于Go-Chassis框架的流量转发模块，负责应用之间的流量转发 
    
    * Controller：通过 KubeEdge 边缘端的 Local APIServer 能力获取元数据（如 Service、Endpoints、Pod 等）
    
    * Tunnel-Agent：基于LibP2P，使用中继和打孔提供跨子网通信的能力
  
  <img title="" src="file:///H:/Project6/KubeEdgeMeshLearning/Proposal/em-arch.png" alt="em-arch.png" width="548" data-align="center">

## 3.  项目需要解决的问题

        核心问题就是让 Agent 实现分布式网络，或者说将Server的功能并入到每一个节点的代理当中，让节点之间能够直接建立通讯，尽量摆脱中心化的网络架构和通信机制。

        问题核心是如何能够将中心机能暂时边缘化，让节点 Agent 仅在特定或者说有限时间与中心节点创建双向连接，获得重要的集群信息

# 二. 解决方案Ⅰ：可行性分析（个人的介绍）

## 1. 技术背景知识

* 项目经历：
  
  在南开大学与天津市共同开发的云边端边缘智能系统的搭建当中主要负责了基于K8S建立的容器编排系统的搭建和再开发。
  
  主要研究方向和内容涉及到边缘网络通信和架构设计

* 个人相关知识储备
  
  * kubernetes  相关
    
    
  
  * Golang开发相关
    
    使用 Golang 开发过 K8S 当中的中心 Server 和边缘 Agent 监控插件，主要使用的是Websocket ，让Agent以推送的方式将的监控信息( Cadviser 以及 CRD 的监控 api 返回 json )传回 Server 存储并展示。
    
    对于 Mesh 的 Sever-Agent 架构有较多的实践经验，入手和深入探究有较多的基础。
    
    以下为本科毕设论文[基于容器编排架构Kubernetes的监控系统设计](file:///./相关材料/基于容器编排架构Kubernetes的监控系统设计)
  
  * 分布式网络架构相关
    
    EdgeGallary
    
    

* 相关调研和实验
  
  * 个人虚拟机实现两台机子的Server和Agent的搭建
  
  * 源代码阅读
  
  * Libp2p相关的学习

## 2. 问题与研究重点分析

    无论如何都需要在边缘节点的代理当中记录相关的路由才能够保障网络通讯的正常进行，但是由于Kubernetes自己的网络设计，它使用veth 将不同容器并入到同一个网络资源的namespace之下，这样一来对于应用开发者来说，所看到的容器和服务资源都是在一台机子上完成的；但也是这样不得不在节点之间设立Center来做通讯，而各个节点只有暂时的网络通信的地址，这样的设计是不能够满足对于分布式网络的需求的。

## 3. 已有的相关技术和解决方案

* 业界相关

* 学术界相关

# 三. 解决方案Ⅱ：方法设计（知识应用）

    对问题总体的设计思路：

## 1. 对问题的思考

## 2. 部分解决思路的

# 四. 时间规划：阶段任务划分

## 1.  个人可用于项目开发的时间规划

这个暑期都会在学校，同时由于我所做的研究方向主要在分布式容器集群的优化管理和边缘网络的建设，这部分的工作与我的研究内容相辅相成，应该是会有充裕的时间来做相关内容的开发。

## 2. 详细时间规划

6月6日--6月30日项目开发预热期

7月1日到9月30日 项目开发
